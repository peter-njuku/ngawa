# Ngawa Solutions - Deployment Guide

## Local Development

### Prerequisites
- Python 3.11+
- Docker & Docker Compose
- PostgreSQL (via Docker) or Neon PostgreSQL

### Setup
1. Clone the repo:
```bash
git clone <repo-url>
cd ngawa
```

2. Create virtual environment:
```bash
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
```

3. Install dependencies:
```bash
pip install -r requirements.txt
```

4. Set environment variables in `.env`:
```bash
cp .env.example .env
```

5. Run migrations:
```bash
python manage.py migrate
```

6. Create superuser:
```bash
python manage.py createsuperuser
```

7. Run development server:
```bash
python manage.py runserver
```

## Docker Development

```bash
docker compose up --build
```

The app will be available at `http://localhost:8000`.

**Admin credentials:**
- Username: `admin`
- Password: `admin123456`

## Production Deployment on Render

### Option 1: Using Neon PostgreSQL (Recommended)

1. **Create Neon Project**
   - Go to [console.neon.tech](https://console.neon.tech)
   - Create a new project and note the connection string

2. **Connect Render**
   - Go to [render.com](https://render.com)
   - Create a new Web Service and connect your GitHub repo
   - During setup, set the following environment variables:

   ```
   DEBUG=False
   DJANGO_SECRET_KEY=<generate-a-new-secret-key>
   ALLOWED_HOSTS=<your-render-domain>.onrender.com
   DB_ENGINE=django.db.backends.postgresql
   POSTGRES_HOST=<neon-host>
   POSTGRES_PORT=5432
   POSTGRES_USER=<neon-user>
   POSTGRES_PASSWORD=<neon-password>
   DB_NAME=<neon-database>
   ```

3. **Build Command**
   ```
   ./build.sh
   ```

4. **Start Command**
   ```
   gunicorn ngawa.wsgi:application --bind 0.0.0.0:$PORT
   ```

### Option 2: Using Render's PostgreSQL

1. Create a Postgres database service on Render
2. Update environment variables to point to Render Postgres
3. Deploy the web service

### Post-Deployment

After deployment, create a superuser:
```bash
render exec python manage.py createsuperuser
```

Or manually set the password in the shell:
```bash
render exec python manage.py shell
```

Then run:
```python
from django.contrib.auth.models import User
u = User.objects.get(username='admin')
u.set_password('new_password')
u.save()
```

## Environment Variables

| Variable | Description | Example |
|----------|-------------|---------|
| DEBUG | Django debug mode | False (production) |
| DJANGO_SECRET_KEY | Django secret key | Generated by Render |
| ALLOWED_HOSTS | Comma-separated allowed hosts | myapp.onrender.com |
| DB_ENGINE | Database backend | django.db.backends.postgresql |
| POSTGRES_HOST | Database host | ep-xyz.c-4.us-east-1.aws.neon.tech |
| POSTGRES_USER | Database user | neondb_owner |
| POSTGRES_PASSWORD | Database password | *** |
| DB_NAME | Database name | neondb |
| POSTGRES_PORT | Database port | 5432 |

## Troubleshooting

### 500 Error
Check logs:
```bash
docker compose logs web
```

### Database Connection Issues
Verify connection string and firewall settings on Neon/Render.

### Static Files Not Loading
```bash
python manage.py collectstatic --noinput
```

## Security Notes

- Always use strong `DJANGO_SECRET_KEY` in production
- Set `DEBUG=False` in production
- Use HTTPS (Render provides free SSL)
- Keep dependencies updated

## Database Migrations

To create new migrations:
```bash
python manage.py makemigrations
python manage.py migrate
```

On Render, migrations run automatically via `build.sh`.
